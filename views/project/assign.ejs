<!DOCTYPE html>
<html>
  <head>
    <% include ../partials/head %>
    <style>
      .panel-heading span {
          margin-top: -20px;
          font-size: 15px;
      }
      .row {
          margin-top: 40px;
          padding: 0 10px;
      }
      .clickable {
          cursor: pointer;
      }

    </style>
  </head>
  <body>
    <div class="header">
      <% include ../partials/header %>
    </div>
    <div class="container" style="margin-top:30px">
      <h4><%= projs[1] %> 업무할당</h4>
      <form role="form" id="body" method="post" action="/test/assign/commit">
        <input type="hidden" name="projno" value="<%= projs[0] %>">
        <div class="row">
          <div class="form-group col-md-4">
            <label for="sel1">테스트 종류</label>
            <select class="form-control" name="testtype" id="sel1">
              <option>(0) 에러리스트</option>
              <option onchange="alert('shit')">(1) 메뉴얼리스트</option>
              <option>(2) 체크리스트</option>
            </select>
          </div>
          <div class="form-group col-md-4">
            <label for="sel1">테스터</label>
            <select class="form-control" name="tester" id="sel1">
              <% testers.forEach(function(tester) { %>
                <option>(<%= tester[0] %>)<%= tester[1] %>[<%= tester[6] %>]</option>
              <% }); %>
            </select>
          </div>
          <div class="form-group col-md-4">
            <label for="InputName">설명</label>
              <div class="input-group">
                  <input type="text" class="form-control" name="projdescription" id="InputName" placeholder="Enter Description">
                  <span class="input-group-addon"><span class="glyphicon glyphicon-asterisk"></span></span>
              </div>
          </div>
        </div>
        <input type="submit" name="submit" id="submit" value="업무 할당" class="btn btn-primary pull-right">
      </form>
      <div class="row" style="margin-top:50px">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title"><center><%= projs[1] %> 정보</center></h3>
            <span class="pull-right clickable"><i class="glyphicon glyphicon-chevron-up"></i></span>
          </div>
          <div class="panel-body">
            <table class="table">
              <tr>
                <th>번호</th>
                <th>카테고리</th>
                <th>스마트폰명</th>
                <th>설명</th>
                <th>시작일</th>
              </tr>
              <tr>
                <td><%= projs[0] %></td>
                <td><%= projs[4] %></td>
                <td><%= projs[1] %></td>
                <td><%= projs[6] %></td>
                <td><%= projs[2].toString().substr(0, 16) %></td>
              </tr>
            </table>
          </div>
        </div>
      </div>

      <div class="row" style="margin-top:50px">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title"><center><%= projs[1] %> 테스트 할당 상황</center></h3>
            <span class="pull-right clickable"><i class="glyphicon glyphicon-chevron-up"></i></span>
          </div>
          <div class="panel-body">
            <table class="table">
              <tr>
                <th>테스트 종류</th>
                <th>테스터</th>
                <th>설명</th>
                <th>시작일</th>
                <th>종료일</th>
                <th>삭제</th>
                <th>결과 확인</th>
              </tr>
              <% projectjobs.forEach(function(proj){ %>
              <tr>
                <!--<td><%= proj[0] %></td>-->
                <td>(<%= proj[1] %>) <% if(proj[1]==0){ %>에러리스트<% }else if(proj[1]==1){ %>메뉴얼리스트<% }else if(proj[1]==2){ %>체크리스트<% }; %></td>
                <td>(<%= proj[7] %>) <%= proj[8] %>[<%= proj[13] %>]</td>
                <td><% if(proj[3]!='undefined'){ %><%= proj[3] %><% }else{ %>None<% }; %></td>
                <td><%= proj[4].toString().substr(0, 16) %></td>
                <td><% if(proj[5]!=null){ %><%= proj[5].toString().substr(0, 16) %><% }else{ %> - <% }; %></td>
                <td><a href="/test/projectjob/delete/<%= proj[0] %>/<%= proj[1] %>/<%= proj[2] %>"><button class="btn btn-primary">삭제</button></a></td>
                <td><button type="button" class="btn btn-primary" data-toggle="modal" data-target="#myModal<%=proj[0]%><%=proj[1]%><%=proj[2]%>">결과 확인</button></td>
              </tr>
              <% }); %>
            </table>
          </div>
        </div>
      </div>

    </div>

    <% projectjobs.forEach(function(proj){ %>
      <div id="myModal<%=proj[0]%><%=proj[1]%><%=proj[2]%>" class="modal fade" role="dialog">
        <div class="modal-dialog">
          <!-- Modal content-->
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal">&times;</button>
              <h4 class="modal-title">(<%= proj[1] %>) <% if(proj[1]==0){ %>에러리스트<% }else if(proj[1]==1){ %>메뉴얼리스트<% }else if(proj[1]==2){ %>체크리스트<% }; %></h4>
              <p class="modal-title">Tester : (<%= proj[7] %>) <%= proj[8] %>[<%= proj[13] %>]</p>
            </div>
            <div class="modal-body">
              <p style="white-space:pre-line"><% if(proj[6]==null){ %>보고된 Report가 없습니다.<% }else{ %><%= proj[6] %><% }; %></p>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-default" data-dismiss="modal">종료</button>
            </div>
          </div>
        </div>
      </div>
    <% }); %>


  </body>
</html>

<script type="text/javascript">
    jQuery(function ($) {
        $('.panel-heading span.clickable').on("click", function (e) {
            if ($(this).hasClass('panel-collapsed')) {
                // expand the panel
                $(this).parents('.panel').find('.panel-body').slideDown();
                $(this).removeClass('panel-collapsed');
                $(this).find('i').removeClass('glyphicon-chevron-down').addClass('glyphicon-chevron-up');
            }
            else {
                // collapse the panel
                $(this).parents('.panel').find('.panel-body').slideUp();
                $(this).addClass('panel-collapsed');
                $(this).find('i').removeClass('glyphicon-chevron-up').addClass('glyphicon-chevron-down');
            }
        });
    });
    $('tr[data-href]').on("click", function() {
    document.location = $(this).data('href');
  });
</script>
